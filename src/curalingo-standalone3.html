<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Curalingo Interpreter Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes spin { to { transform: rotate(360deg); } }
        .animate-spin { animation: spin 1s linear infinite; }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <div id="app"></div>

    <script type="module">
        import { html, render, useState, useEffect, useRef } from 'https://cdn.jsdelivr.net/npm/htm@3.1.1/preact/standalone.module.js';

        const CuralingoPortal = () => {
            const [view, setView] = useState('dashboard');
            const [user, setUser] = useState(null);
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [loginEmail, setLoginEmail] = useState('');
            const [dailyRecords, setDailyRecords] = useState([]);
            const [assignments, setAssignments] = useState([]);
            const [notifications, setNotifications] = useState([]);
            const [messages, setMessages] = useState([]);
            const [todayRecord, setTodayRecord] = useState(null);
            const [showCamera, setShowCamera] = useState(false);
            const [showMessageModal, setShowMessageModal] = useState(false);
            const [checkInType, setCheckInType] = useState(null);
            const [cameraReady, setCameraReady] = useState(false);
            const [messageForm, setMessageForm] = useState({subject: '', message: '', priority: 'medium'});
            const videoRef = useRef(null);
            const streamRef = useRef(null);

            useEffect(() => {
                loadData();
            }, []);

            const loadData = () => {
                const userData = localStorage.getItem('currentUser');
                if (userData) {
                    const u = JSON.parse(userData);
                    setUser(u);
                    setIsLoggedIn(true);
                    
                    const records = localStorage.getItem('dailyRecords_' + u.id);
                    if (records) setDailyRecords(JSON.parse(records));
                    
                    const assign = localStorage.getItem('assignments_' + u.id);
                    if (assign) setAssignments(JSON.parse(assign));
                    
                    const notif = localStorage.getItem('notifications_' + u.id);
                    if (notif) setNotifications(JSON.parse(notif));

                    const msgs = localStorage.getItem('messages_' + u.id);
                    if (msgs) setMessages(JSON.parse(msgs));
                    
                    const today = localStorage.getItem('todayRecord_' + u.id);
                    if (today) {
                        const record = JSON.parse(today);
                        const recordDate = new Date(record.checkInTime).toDateString();
                        const nowDate = new Date().toDateString();
                        if (recordDate === nowDate) {
                            setTodayRecord(record);
                        } else {
                            localStorage.removeItem('todayRecord_' + u.id);
                        }
                    }
                }
            };

            const handleLogin = () => {
                if (!loginEmail) return;
                const userId = 'u_' + Date.now();
                const u = {
                    id: userId,
                    displayName: loginEmail.split('@')[0],
                    email: loginEmail,
                    role: 'interpreter',
                    lang_pairs: ['English-Spanish', 'English-Vietnamese'],
                    status: 'active',
                    workSchedule: { start: '09:00', end: '17:00' }
                };
                localStorage.setItem('currentUser', JSON.stringify(u));
                
                const demoAssignments = [
                    {id: 'a1', title: 'Medical Interpretation - City Hospital', location: '123 Medical Center Dr', date: new Date(Date.now() + 7200000).toISOString(), languagePair: 'English-Vietnamese', duration: '4 hours', status: 'scheduled'},
                    {id: 'a2', title: 'Legal Interpretation - District Court', location: '456 Justice Blvd', date: new Date(Date.now() + 86400000).toISOString(), languagePair: 'English-Spanish', duration: '3 hours', status: 'scheduled'}
                ];
                localStorage.setItem('assignments_' + userId, JSON.stringify(demoAssignments));

                const demoNotif = [
                    {id: 'n1', type: 'training', title: 'Mandatory Training: Medical Terminology', description: 'Advanced medical terminology session - Nov 5, 2PM', date: new Date(Date.now() + 432000000).toISOString(), priority: 'high', tags: ['training', 'medical'], read: false},
                    {id: 'n2', type: 'qa_session', title: 'QA Review Session - Q4 2024', description: 'Quarterly performance review', date: new Date(Date.now() + 259200000).toISOString(), priority: 'medium', tags: ['qa', 'review'], read: false}
                ];
                localStorage.setItem('notifications_' + userId, JSON.stringify(demoNotif));
                
                setAssignments(demoAssignments);
                setNotifications(demoNotif);
                setUser(u);
                setIsLoggedIn(true);
            };

            const handleLogout = () => {
                stopCamera();
                localStorage.removeItem('currentUser');
                setIsLoggedIn(false);
                setUser(null);
                setDailyRecords([]);
                setAssignments([]);
                setNotifications([]);
                setMessages([]);
                setTodayRecord(null);
            };

            const startCamera = async (type) => {
                if (type === 'in' && todayRecord?.checkInTime) {
                    alert('Already clocked in today');
                    return;
                }
                if (type === 'out' && (!todayRecord || !todayRecord.checkInTime)) {
                    alert('Must clock in first');
                    return;
                }
                if (type === 'out' && todayRecord?.checkOutTime) {
                    alert('Already clocked out');
                    return;
                }

                setCheckInType(type);
                setShowCamera(true);
                setCameraReady(false);

                setTimeout(async () => {
                    try {
                        const stream = await navigator.mediaDevices.getUserMedia({
                            video: { width: 640, height: 480, facingMode: 'user' }
                        });
                        streamRef.current = stream;
                        if (videoRef.current) {
                            videoRef.current.srcObject = stream;
                            await videoRef.current.play();
                            setCameraReady(true);
                        }
                    } catch (e) {
                        console.error('Camera error:', e);
                        alert('Camera unavailable: ' + e.message);
                    }
                }, 300);
            };

            const stopCamera = () => {
                if (streamRef.current) {
                    streamRef.current.getTracks().forEach(t => t.stop());
                    streamRef.current = null;
                }
                if (videoRef.current) {
                    videoRef.current.srcObject = null;
                }
                setCameraReady(false);
            };

            const capturePhoto = () => {
                if (!videoRef.current || !cameraReady) {
                    alert('Camera not ready');
                    return;
                }
                const canvas = document.createElement('canvas');
                canvas.width = 640;
                canvas.height = 480;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(videoRef.current, 0, 0, 640, 480);
                canvas.toBlob((blob) => {
                    const reader = new FileReader();
                    reader.onloadend = () => completeCheckInOut(reader.result);
                    reader.readAsDataURL(blob);
                }, 'image/jpeg', 0.7);
            };

            const completeCheckInOut = (photo) => {
                stopCamera();
                const now = new Date();
                const timeString = now.toISOString();

                if (checkInType === 'in') {
                    const workStart = new Date();
                    const scheduleStart = user.workSchedule?.start || '09:00';
                    const [startHour, startMin] = scheduleStart.split(':');
                    workStart.setHours(parseInt(startHour), parseInt(startMin), 0, 0);
                    const isLate = now > workStart;
                    const minutesLate = isLate ? Math.floor((now - workStart) / 60000) : 0;

                    const newRecord = {
                        id: 'rec_' + Date.now(),
                        userId: user.id,
                        userName: user.displayName,
                        userEmail: user.email,
                        date: now.toDateString(),
                        checkInTime: timeString,
                        checkInPhoto: photo,
                        checkOutTime: null,
                        checkOutPhoto: null,
                        status: isLate ? 'late' : 'on-time',
                        minutesLate: minutesLate,
                        totalHours: null
                    };

                    localStorage.setItem('todayRecord_' + user.id, JSON.stringify(newRecord));
                    const allRec = [...dailyRecords, newRecord];
                    localStorage.setItem('dailyRecords_' + user.id, JSON.stringify(allRec));
                    
                    // Save to shared admin storage
                    const allRecords = JSON.parse(localStorage.getItem('admin_allRecords') || '[]');
                    allRecords.push(newRecord);
                    localStorage.setItem('admin_allRecords', JSON.stringify(allRecords));
                    
                    setTodayRecord(newRecord);
                    setDailyRecords(allRec);
                    alert(isLate ? `Clocked in (${minutesLate} min late)` : 'Clocked in on time!');
                } else {
                    const updatedRecord = {
                        ...todayRecord,
                        checkOutTime: timeString,
                        checkOutPhoto: photo,
                        status: 'completed'
                    };
                    const checkIn = new Date(todayRecord.checkInTime);
                    const hours = ((now - checkIn) / 3600000).toFixed(2);
                    updatedRecord.totalHours = hours;

                    localStorage.setItem('todayRecord_' + user.id, JSON.stringify(updatedRecord));
                    const updated = dailyRecords.map(r => r.id === todayRecord.id ? updatedRecord : r);
                    localStorage.setItem('dailyRecords_' + user.id, JSON.stringify(updated));
                    
                    // Update in shared admin storage
                    const allRecords = JSON.parse(localStorage.getItem('admin_allRecords') || '[]');
                    const updatedAll = allRecords.map(r => r.id === todayRecord.id ? updatedRecord : r);
                    localStorage.setItem('admin_allRecords', JSON.stringify(updatedAll));
                    
                    setTodayRecord(updatedRecord);
                    setDailyRecords(updated);
                    alert(`Clocked out! Total: ${hours} hours`);
                }

                setShowCamera(false);
                setCheckInType(null);
            };

            const sendMessage = () => {
                if (!messageForm.subject || !messageForm.message) {
                    alert('Please fill in all fields');
                    return;
                }

                const newMsg = {
                    id: 'msg_' + Date.now(),
                    userId: user.id,
                    userName: user.displayName,
                    userEmail: user.email,
                    subject: messageForm.subject,
                    message: messageForm.message,
                    priority: messageForm.priority,
                    timestamp: new Date().toISOString(),
                    status: 'sent',
                    read: false
                };

                // Save to user messages
                const updatedMsgs = [...messages, newMsg];
                localStorage.setItem('messages_' + user.id, JSON.stringify(updatedMsgs));
                setMessages(updatedMsgs);

                // Save to admin messages
                const adminMsgs = JSON.parse(localStorage.getItem('admin_messages') || '[]');
                adminMsgs.push(newMsg);
                localStorage.setItem('admin_messages', JSON.stringify(adminMsgs));

                setShowMessageModal(false);
                setMessageForm({subject: '', message: '', priority: 'medium'});
                alert('Message sent to admin successfully!');
            };

            const markNotificationRead = (id) => {
                const updated = notifications.map(n => n.id === id ? {...n, read: true} : n);
                setNotifications(updated);
                localStorage.setItem('notifications_' + user.id, JSON.stringify(updated));
            };

            const checkInWithoutPhoto = () => completeCheckInOut(null);
            const cancelCamera = () => {
                stopCamera();
                setShowCamera(false);
                setCheckInType(null);
            };

            const unread = notifications.filter(n => !n.read).length;

            if (!isLoggedIn || !user) {
                return html`
                    <div class="min-h-screen bg-gradient-to-br from-gray-900 to-gray-800 flex items-center justify-center p-4">
                        <div class="bg-gray-800 rounded-lg shadow-2xl p-8 max-w-md w-full border border-gray-700">
                            <div class="text-center mb-8">
                                <h1 class="text-4xl font-bold text-white mb-2">Curalingo</h1>
                                <p class="text-gray-400">Interpreter Portal</p>
                            </div>
                            <input
                                type="email"
                                placeholder="Enter your email"
                                value=${loginEmail}
                                onInput=${(e) => setLoginEmail(e.target.value)}
                                onKeyPress=${(e) => e.key === 'Enter' && handleLogin()}
                                class="w-full px-4 py-3 mb-4 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-blue-500"
                            />
                            <button onClick=${handleLogin} class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg">
                                Sign In
                            </button>
                            <p class="text-gray-500 text-sm text-center mt-6">Demo: Enter any email</p>
                        </div>
                    </div>
                `;
            }

            const navItems = [
                {id: 'dashboard', label: '🏠 Dashboard'},
                {id: 'assignments', label: '📋 Assignments'},
                {id: 'history', label: '⏱️ History'},
                {id: 'notifications', label: '🔔 Notifications', badge: unread},
                {id: 'messages', label: '💬 Messages'},
                {id: 'profile', label: '👤 Profile'}
            ];

            return html`
                <div class="min-h-screen bg-gray-900 text-white">
                    <header class="bg-gray-800 border-b border-gray-700 px-6 py-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4">
                                <h1 class="text-2xl font-bold text-blue-400 cursor-pointer" onClick=${() => setView('dashboard')}>Curalingo</h1>
                                ${todayRecord?.checkInTime && !todayRecord?.checkOutTime ? html`
                                    <div class="flex items-center space-x-2 bg-green-900 bg-opacity-30 px-3 py-1 rounded-full border border-green-700">
                                        <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                                        <span class="text-sm text-green-300">Clocked In</span>
                                    </div>
                                ` : ''}
                            </div>
                            <button onClick=${handleLogout} class="text-gray-400 hover:text-white">Logout</button>
                        </div>
                    </header>

                    <div class="flex">
                        <aside class="w-64 bg-gray-800 min-h-screen border-r border-gray-700 p-4">
                            <nav class="space-y-2">
                                ${navItems.map(item => html`
                                    <button
                                        key=${item.id}
                                        onClick=${() => setView(item.id)}
                                        class=${`w-full text-left px-4 py-3 rounded-lg flex items-center justify-between ${view === item.id ? 'bg-blue-600 text-white' : 'text-gray-300 hover:bg-gray-700'}`}
                                    >
                                        <span>${item.label}</span>
                                        ${item.badge > 0 ? html`<span class="bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">${item.badge}</span>` : ''}
                                    </button>
                                `)}
                            </nav>
                        </aside>

                        <main class="flex-1 p-6">
                            ${view === 'dashboard' && html`
                                <div class="space-y-6">
                                    <h2 class="text-3xl font-bold">Dashboard</h2>
                                    <div class="bg-gray-800 border border-gray-700 rounded-lg p-8">
                                        <h3 class="text-2xl font-semibold mb-6 text-center">Time Clock</h3>
                                        <div class="text-center mb-6">
                                            <div class="text-5xl font-bold text-blue-400 mb-2">${new Date().toLocaleTimeString()}</div>
                                            <div class="text-lg text-gray-400">${new Date().toDateString()}</div>
                                        </div>
                                        ${todayRecord?.checkInTime && !todayRecord?.checkOutTime ? html`
                                            <div class="space-y-4">
                                                <div class="bg-green-900 bg-opacity-20 border border-green-700 rounded-lg p-4">
                                                    <p class="text-green-300 font-semibold">Clocked In</p>
                                                    <p class="text-gray-300">Time: ${new Date(todayRecord.checkInTime).toLocaleTimeString()}</p>
                                                </div>
                                                <button onClick=${() => startCamera('out')} class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-4 rounded-lg text-xl">
                                                    📸 Clock Out
                                                </button>
                                            </div>
                                        ` : todayRecord?.checkOutTime ? html`
                                            <div class="bg-blue-900 bg-opacity-20 border border-blue-700 rounded-lg p-4">
                                                <p class="text-blue-300 font-semibold mb-2">Work Complete</p>
                                                <p class="text-gray-300">In: ${new Date(todayRecord.checkInTime).toLocaleTimeString()}</p>
                                                <p class="text-gray-300">Out: ${new Date(todayRecord.checkOutTime).toLocaleTimeString()}</p>
                                                <p class="text-green-400 font-bold mt-2">Hours: ${todayRecord.totalHours}</p>
                                            </div>
                                        ` : html`
                                            <button onClick=${() => startCamera('in')} class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 rounded-lg text-xl">
                                                📸 Clock In
                                            </button>
                                        `}
                                    </div>

                                    ${assignments.length > 0 && html`
                                        <div class="bg-gray-800 border border-gray-700 rounded-lg p-6">
                                            <h3 class="text-xl font-semibold mb-4">Upcoming Assignments</h3>
                                            ${assignments.slice(0, 3).map(a => html`
                                                <div key=${a.id} class="bg-gray-700 rounded-lg p-4 mb-3">
                                                    <p class="font-semibold">${a.title}</p>
                                                    <p class="text-sm text-gray-400">${new Date(a.date).toLocaleString()} - ${a.languagePair}</p>
                                                    <p class="text-sm text-gray-400">${a.location} • ${a.duration}</p>
                                                </div>
                                            `)}
                                        </div>
                                    `}
                                </div>
                            `}

                            ${view === 'assignments' && html`
                                <div class="space-y-6">
                                    <h2 class="text-3xl font-bold">Assignments</h2>
                                    <div class="bg-gray-800 border border-gray-700 rounded-lg p-6">
                                        ${assignments.length > 0 ? assignments.map(a => html`
                                            <div key=${a.id} class="bg-gray-700 rounded-lg p-4 mb-3">
                                                <div class="flex items-start justify-between">
                                                    <div class="flex-1">
                                                        <p class="font-semibold text-lg">${a.title}</p>
                                                        <p class="text-sm text-gray-400 mt-1">📅 ${new Date(a.date).toLocaleString()}</p>
                                                        <p class="text-sm text-gray-400">📍 ${a.location}</p>
                                                        <p class="text-sm text-gray-400">🗣️ ${a.languagePair} • ${a.duration}</p>
                                                    </div>
                                                    <span class="px-3 py-1 rounded-full text-xs font-semibold bg-blue-900 text-blue-300">
                                                        ${a.status.toUpperCase()}
                                                    </span>
                                                </div>
                                            </div>
                                        `) : html`<p class="text-gray-400 text-center py-8">No assignments</p>`}
                                    </div>
                                </div>
                            `}

                            ${view === 'history' && html`
                                <div class="space-y-6">
                                    <h2 class="text-3xl font-bold">Work History</h2>
                                    <div class="bg-gray-800 border border-gray-700 rounded-lg p-6">
                                        ${dailyRecords.length > 0 ? dailyRecords.slice().reverse().map(rec => html`
                                            <div key=${rec.id} class="bg-gray-700 rounded-lg p-4 mb-3">
                                                <div class="flex items-start justify-between">
                                                    <div>
                                                        <p class="font-semibold">${rec.date}</p>
                                                        <p class="text-sm text-gray-400">In: ${new Date(rec.checkInTime).toLocaleTimeString()}</p>
                                                        ${rec.checkOutTime ? html`<p class="text-sm text-gray-400">Out: ${new Date(rec.checkOutTime).toLocaleTimeString()}</p>` : ''}
                                                        ${rec.totalHours ? html`<p class="text-green-400 font-semibold">Hours: ${rec.totalHours}</p>` : ''}
                                                    </div>
                                                    ${rec.checkInPhoto ? html`<img src=${rec.checkInPhoto} alt="Check in" class="w-12 h-12 rounded-full object-cover" />` : ''}
                                                </div>
                                            </div>
                                        `) : html`<p class="text-gray-400 text-center py-8">No history</p>`}
                                    </div>
                                </div>
                            `}

                            ${view === 'notifications' && html`
                                <div class="space-y-6">
                                    <h2 class="text-3xl font-bold">Notifications</h2>
                                    ${notifications.map(n => html`
                                        <div 
                                            key=${n.id} 
                                            class=${`bg-gray-800 border rounded-lg p-6 cursor-pointer ${n.read ? 'border-gray-700' : 'border-yellow-600'}`}
                                            onClick=${() => markNotificationRead(n.id)}
                                        >
                                            <div class="flex items-start justify-between mb-2">
                                                <h3 class="font-semibold">${n.title}</h3>
                                                ${!n.read ? html`<span class="bg-yellow-500 text-black text-xs px-2 py-1 rounded">NEW</span>` : ''}
                                            </div>
                                            <p class="text-gray-300 mb-3">${n.description}</p>
                                            <p class="text-sm text-gray-400">${new Date(n.date).toLocaleDateString()}</p>
                                        </div>
                                    `)}
                                </div>
                            `}

                            ${view === 'messages' && html`
                                <div class="space-y-6">
                                    <div class="flex items-center justify-between">
                                        <h2 class="text-3xl font-bold">Messages</h2>
                                        <button onClick=${() => setShowMessageModal(true)} class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">
                                            ✉️ New Message
                                        </button>
                                    </div>
                                    <div class="bg-gray-800 border border-gray-700 rounded-lg p-6">
                                        ${messages.length > 0 ? messages.slice().reverse().map(m => html`
                                            <div key=${m.id} class="bg-gray-700 rounded-lg p-4 mb-3">
                                                <div class="flex items-center justify-between mb-2">
                                                    <p class="font-semibold">${m.subject}</p>
                                                    <span class="text-xs text-gray-400">${new Date(m.timestamp).toLocaleString()}</span>
                                                </div>
                                                <p class="text-sm text-gray-300">${m.message}</p>
                                                <p class="text-xs text-gray-500 mt-2">Status: ${m.status}</p>
                                            </div>
                                        `) : html`<p class="text-gray-400 text-center py-8">No messages. Click "New Message" to contact admin.</p>`}
                                    </div>
                                </div>
                            `}

                            ${view === 'profile' && html`
                                <div class="space-y-6">
                                    <h2 class="text-3xl font-bold">My Profile</h2>
                                    <div class="bg-gray-800 border border-gray-700 rounded-lg p-6 space-y-4">
                                        <div>
                                            <label class="block text-sm text-gray-400 mb-2">Name</label>
                                            <input type="text" value=${user.displayName} class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white" readOnly />
                                        </div>
                                        <div>
                                            <label class="block text-sm text-gray-400 mb-2">Email</label>
                                            <input type="email" value=${user.email} class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white" readOnly />
                                        </div>
                                        <div>
                                            <label class="block text-sm text-gray-400 mb-2">Languages</label>
                                            <div class="flex gap-2">
                                                ${user.lang_pairs.map((p, i) => html`<span key=${i} class="bg-blue-900 bg-opacity-30 text-blue-300 px-3 py-1 rounded-full text-sm">${p}</span>`)}
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block text-sm text-gray-400 mb-2">Work Schedule</label>
                                            <p class="text-white">${user.workSchedule?.start || '09:00'} - ${user.workSchedule?.end || '17:00'}</p>
                                        </div>
                                    </div>
                                </div>
                            `}
                        </main>
                    </div>

                    ${showCamera && html`
                        <div class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4">
                            <div class="bg-gray-800 rounded-lg p-6 max-w-2xl w-full border border-gray-700">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-xl font-bold">Camera - Clock ${checkInType === 'in' ? 'In' : 'Out'}</h3>
                                    <button onClick=${cancelCamera} class="text-gray-400 hover:text-white text-2xl">×</button>
                                </div>
                                <div class="bg-black rounded-lg mb-4" style="min-height: 400px;">
                                    <video ref=${videoRef} autoplay playsinline muted class="w-full rounded-lg" style="max-height: 400px;"></video>
                                </div>
                                <p class="text-center mb-4 text-gray-400">${cameraReady ? 'Camera ready!' : 'Starting camera...'}</p>
                                <div class="flex space-x-3">
                                    <button 
                                        onClick=${capturePhoto} 
                                        disabled=${!cameraReady}
                                        class=${`flex-1 py-3 rounded-lg ${cameraReady ? 'bg-blue-600 hover:bg-blue-700' : 'bg-gray-600 cursor-not-allowed'} text-white`}
                                    >
                                        📸 Capture Photo
                                    </button>
                                    <button onClick=${checkInWithoutPhoto} class="flex-1 bg-gray-700 hover:bg-gray-600 text-white py-3 rounded-lg">
                                        Skip Photo
                                    </button>
                                </div>
                            </div>
                        </div>
                    `}

                    ${showMessageModal && html`
                        <div class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4">
                            <div class="bg-gray-800 rounded-lg p-6 max-w-2xl w-full border border-gray-700">
                                <div class="flex items-center justify-between mb-6">
                                    <h3 class="text-2xl font-bold">Send Message to Admin</h3>
                                    <button onClick=${() => setShowMessageModal(false)} class="text-gray-400 hover:text-white text-2xl">×</button>
                                </div>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm text-gray-400 mb-2">Priority</label>
                                        <select 
                                            value=${messageForm.priority} 
                                            onInput=${(e) => setMessageForm({...messageForm, priority: e.target.value})} 
                                            class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white"
                                        >
                                            <option value="low">Low</option>
                                            <option value="medium">Medium</option>
                                            <option value="high">High - Urgent</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm text-gray-400 mb-2">Subject</label>
                                        <input 
                                            type="text" 
                                            placeholder="Message subject"
                                            value=${messageForm.subject} 
                                            onInput=${(e) => setMessageForm({...messageForm, subject: e.target.value})} 
                                            class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white"
                                        />
                                    </div>
                                    <div>
                                        <label class="block text-sm text-gray-400 mb-2">Message</label>
                                        <textarea 
                                            placeholder="Describe your issue or question..."
                                            value=${messageForm.message} 
                                            onInput=${(e) => setMessageForm({...messageForm, message: e.target.value})} 
                                            class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white h-32"
                                        ></textarea>
                                    </div>
                                    <div class="flex space-x-3">
                                        <button onClick=${sendMessage} class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg">
                                            Send Message
                                        </button>
                                        <button onClick=${() => setShowMessageModal(false)} class="flex-1 bg-gray-700 hover:bg-gray-600 text-white py-3 rounded-lg">
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `}
                </div>
            `;
        };

        render(html`<${CuralingoPortal} />`, document.getElementById('app'));
    </script>
</body>
</html>
                